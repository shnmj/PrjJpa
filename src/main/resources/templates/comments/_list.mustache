<div id="comments-list">
	{{#commentDtos}}
	  <!-- comments-id = comment.id --> 
	  <div class="card m-2" id="comments-{{id}}">
		  <div class="card-header">
		  	{{nickname}}
		  	&nbsp;&nbsp;&nbsp;
		  	<!-- Button trigger modal 댓글 수정 버튼 -->
		   	<button type="button"
		   		class="btn btn-sm btn-outline-primary"
		   		
		   			data-bs-toggle="modal"
		   			data-bs-target="#comment-edit-modal"
		   			data-bs-id="{{id}}"
		   			data-bs-nickname="{{nickname}}"
		   			data-bs-body="{{body}}"
		   			data-bs-article-id="{{articleId}}"
		   		
		   		>수정</button>
		    		&nbsp;
		    		
		    <!-- 댓글 삭제 버튼 -->
	   	  <button type="button"
	   			class="btn btn-sm btn-outline-danger comment-delete-btn">삭제</button> 
	   				( {{id}}, {{articleId}} )
		  </div>
		  <div class="card-body">
		    {{body}}
		  </div>
	  {{/commentDtos}}
	</div>
	
		
<!-- Modal 처리 -->
<div class="modal fade" id="comment-edit-modal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
      	<h5 class="modal-title" id"exampleModalLabel">댓글 수정</h5>
        <button type="button" 
		        		class="btn-close" 
		        		data-bs-dismiss="modal" 
		        		aria-label="Close"></button>
      </div>
      
      <!-- 수정 화면 -->
      <div class="modal-body">
        <!-- 댓글 수정 폼 -->
        <form>
        	<!-- 댓글 id, article_id 둘 다 hidden 으로 전송 -->
        	<input type="hidden" id="edit-comment-id" />
        	<input type="hidden" id="edit-comment-article-id" />
        	
        <!-- 닉네임 -->
        	<div class="mb-3">
        		<label class="form-label">닉네임</label>
        			<input type="text" class="form-control" id="edit-comment-nickname" />
        	</div>
        	
        <!-- 댓글 본문 -->
        	<div class="mb-3">
        		<label class="form-label">댓글 본문</label>
        			<textarea type="text" class="form-control" rows="3"
        				id="edit-comment-body"></textarea>
        	</div>
        	
        </form>
      </div>
      
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" id="comment-update-btn">Save changes</button>
      </div>
    </div>
  </div>
</div>
	
<!-- Modal Event 처리 (dialog가 화면에 나타날 때 해야할 일 
			수정할 자료를 입력받아서 moad vic table에 블러오기
-->
<script>

	// Modal 창을 찾는다
	const commentEditModal = document.querySelector('#comment-edit-modal')
	
	// Event 연결 : show.bs.modal - modal 화면이 그려지기 전
	commentEditModal.addEventListener('show.bs.modal', (event)=> { 
		console.dir(event);
		// alert('show.bs.modal');
		// 1. Trigger Button 선택
		const triggerBtn = event.relatedTarget;
		
		// 2. Data 가져오기
		let id           = triggerBtn.getAttribute("data-bs-id")
		let nickname     = triggerBtn.getAttribute("data-bs-nickname")
		let body         = triggerBtn.getAttribute("data-bs-body")
		let articleId    = triggerBtn.getAttribute("data-bs-article-id")
		let cmt          = `id:${id},
											  nickname:${nickname},
		                    body:${body},
											  articleId:${articleId}`;
		alert(cmt)
		
		// 3. 수정 Form에 Data 집어넣기
		document.querySelector('#edit-comment-nickname').value   = nickname;
		document.querySelector('#edit-comment-body').value       = body;
		document.querySelector('#edit-comment-id').value         = id;
		document.querySelector('#edit-comment-article-id').value = articleId;
		
	})
	
	// Event 연결 : shown.bs.modal - modal 화면이 그려진 후
	commentEditModal.addEventListener('show.bs.modal', (event)=> { 
		// alert('shown.bs.modal');
	})
	
</script>
	
<!-- 댓글 수정 : Save Change 클릭 시 -->
<script>
	const commentUpdateBtn =  document.getElementById('comment-update-btn');
	// const comment-update-btn =  document.querySelector('#comment-update-btn');
	commentUpdateBtn.addEventListener('click', (event) => {
		
		let comment = {
				id        : document.querySelector('#edit-comment-id').value,
				articleId : document.querySelector('#edit-comment-article-id').value,
				nickname  : document.querySelector('#edit-comment-nickname').value,
				body      : document.querySelector('#edit-comment-body').value
		} 
		let url     = '/api/comments/' + comment.id;
		let params  = {
				method  : 'PATCH',
				headers : {"Content-Type" : "application/json"},
				body    : JSON.stringify(comment)
				
		} 
		fetch(url, params)   // Rest API 호출
			.then(response => {
					console.log(response)
					let msg = (response.ok) ? "댓글이 수정되었습니다"
							                    : "댓글 수정 실패";
					alert(msg);
					// 1. 전체 페이지 새로고침 Cont 재요청
					window.location.reload();
					
					/* 2. Get 댓글만 조회 -> 결과를 json으로 받아서 
						 그 json을 html로 변경 후 <div id="comments-list"> 변경 내용을 수정
					*/
			})
		
	})
	
</script>

<!-- 댓글 삭제 -->
<script>

</script>
	
	
	
	